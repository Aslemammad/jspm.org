System.register(['lit-element','buffer','zlib','codemirror','codemirror/mode/css/css.js','codemirror/mode/javascript/javascript.js','codemirror/mode/xml/xml.js','codemirror/mode/htmlmixed/htmlmixed.js','util','es-module-lexer','./chunk-329fee5d.js','lit-html/directives/unsafe-html.js','crypto','os','sver','sver/convert-range'],function(){'use strict';var LitElement,css,html,lexer,parse,unsafeHTML,crypto,os,sver,convertRange;return{setters:[function(module){LitElement=module.LitElement;css=module.css;html=module.html;},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(){},function(module){lexer=module.default;},function(module){parse=module.p;},function(module){unsafeHTML=module.unsafeHTML;},function(module){crypto=module.default;},function(module){os=module.default;},function(module){sver=module.default;},function(module){convertRange=module.default;}],execute:function(){class WebCmdToast extends LitElement{static get styles(){return css`
      :host {
        position: fixed;
        bottom: 0.5em;
        opacity: 0;
        right: 0.5em;
        width: 20em;
        background-color: #eee;
        padding: 0.5em;
        box-shadow: 0 0 0.2em #bbb;
        border-radius: 0.1em;
      }
      :host(.animate) {
        transition: bottom 0.2s ease-out, opacity 0.2s ease-in;
      }
      :host h1 {
        font-family: sans-serif;
        font-size: 0.8em;
        margin: 0;
        margin-bottom: 0.3em;
      }
      :host > .close {
        user-select: none;
        position: absolute;
        top: 0;
        right: 0.25em;
        font-size: 1.5em;
        cursor: pointer;
        color: #555;
      }
      :host > .close:hover {
        color: #444;
      }
      :host > .close:active {
        color: #111;
      }
      :host > .content {
        font-family: sans-serif;
        font-size: 0.8em;
        overflow-wrap: break-word;
      }
      button {
        cursor: pointer;
        background: none;
        border: 1px solid #ccc;
        background-color: #ddd;
        margin-top: 0.5em;
      }
      button:hover {
        background-color: #eee;
      }
      button:active {
        background-color: #ccc;
      }
    `}constructor(t){super(),this.style["z-index"]=1e3,t&&(Object.assign(this,t),document.body.appendChild(this)),setTimeout(()=>{this.className+=" animate",this.style.bottom="",this.style.opacity="1";},10);const e=parseInt(this.timeout,10)||1e3;this._timeout=setTimeout(()=>{this.close();},e),this.style.bottom="-"+(this.clientHeight+10)+"px";}close(){this._timeout&&(clearTimeout(this._timeout),this._timeout=null,this.style.opacity="0",setTimeout(()=>{this.parentNode&&this.parentNode.removeChild(this);},350));}render(){return html`
      <h1 class="title">${this.title||"&nbsp;"}</h1>
      <div class="close" @click=${this.close}>Ã—</div>
      <div class="content"><slot></slot></div>
    `}}customElements.define("webcmd-toast",WebCmdToast);class WebCmd extends LitElement{static get properties(){return {visible:{attribute:!1},selected:{attribute:!1},info:{attribute:!1},filteredCommands:{attribute:!1,hasChanged:(t,e)=>e&&(t.length!==e.length||t.some((t,s)=>e[s]!==t))}}}constructor(t){super(),this.commands=t||[],this.selected=null,this.visible=!1,this.info="&nbsp;",this.style.visibility="hidden",this.updateFilteredCommands();const e=t=>{this.visible&&t.target!==this&&this.hide();};addEventListener("mousedown",e),addEventListener("focus",e),addEventListener("keydown",t=>{switch(t.key){case"p":case"P":t.ctrlKey&&(this.toggle(),t.preventDefault());break;case"Escape":this.hide(),t.preventDefault();break;case"ArrowDown":if(!this.visible)break;this.down(),t.preventDefault();break;case"ArrowUp":if(!this.visible)break;this.up(),t.preventDefault();break;case"ArrowRight":if(!this.visible)break;this.right(),t.preventDefault();break;case"Enter":if(!this.visible)break;this.enter(),t.preventDefault();}});}registerCommand(t){this.commands.push(t),this.updateFilteredCommands();}registerCommands(t){for(const e of t)this.registerCommand(e);}async run(t,e){if(t.validate){const s=t.validate.call(this.run.bind(this),...e);if(s)return this.info=`<span class="err">${s}</span>`,!0}this.hide();const s=await t.run.call(this.run.bind(this),...e);s&&new WebCmdToast(s);}click(t){let e=t.target;for(;e&&"LI"!==e.tagName;)e=t.target.parentNode;const s=[...this.shadowRoot.querySelectorAll("ul li")].findIndex(t=>t===e);this.$input.focus(),-1!==s&&(this.selectd=this.filteredCommands[s],this.enter(!0));}async show(){this.visible=!0,this.style.visibility="visible",await this.updateComplete,this.$input.focus(),this.$input.setSelectionRange(this.$input.value.length,this.$input.value.length),this.dispatchEvent(new CustomEvent("show"));}hide(){this.$input.value="",this.visible=!1,this.style.visibility="hidden",this.updateFilteredCommands(),this.dispatchEvent(new CustomEvent("hide"));}async toggle(){this.visible?this.hide():await this.show();}async enter(t=!1){const e=this.selected;if(!e)return void(this.info=`<span class="err">No <strong>${this.$input.value.trim()}</strong> command defined.</span>`);if(!this.$input.value.startsWith(e.name)&&(this.$input.value=e.name+" ",this.updateFilteredCommands(),!t&&e.run.length))return;await this.run(e,this.$input.value.slice(e.name).trim().split(" ").slice(1))&&this.$input.value===e.name&&(this.$input.value=e.name+" ",this.updateFilteredCommands());}down(){const t=this.filteredCommands.indexOf(this.selected);-1===t?this.selected=this.filteredCommands[0]:t+1<this.filteredCommands.length?this.selected=this.filteredCommands[t+1]:this.selected=this.filteredCommands[0];}up(){const t=this.filteredCommands.indexOf(this.selected);this.selected=-1===t?this.filteredCommands[0]:t-1>=0?this.filteredCommands[t-1]:this.filteredCommands[this.filteredCommands.length-1];}right(){if(this.$input.selectionStart!==this.$input.value.length||this.$input.selectionEnd!==this.$input.value.length)return;if(0===this.filteredCommands.length)return;const t=this.selected;t&&(this.$input.value.startsWith(t+" ")||(this.$input.value=t.name+" "));}firstUpdated(){this.$input=this.shadowRoot.querySelector("input"),this.$input.focus();}updateFilteredCommands(){const t=this.$input?this.$input.value:"",e=t.split(" ")[0];this.filteredCommands=this.commands.filter(({name:s,description:i})=>""===t||s.startsWith(e)||-1!==i.toLowerCase().indexOf(t)).sort((s,i)=>{if(""===t||s.name.startsWith(e)&&i.name.startsWith(e))return 0;if(s.name.startsWith(e))return -1;if(i.name.startsWith(e))return 1;const n=s.description.toLowerCase().indexOf(t),a=s.description.toLowerCase().indexOf(t);return n===a?0:a<n?1:-1}),-1===this.filteredCommands.indexOf(this.selected)&&(this.selected=this.filteredCommands[0]);}update(t){if(!t.has("info")){const e=this.info;"&nbsp"!==e&&(this.info="&nbsp",t.set("info",e));}super.update(t);}render(){return html`
      <span class="cmd-symbol">&gt;</span>
      <input type="text" spellcheck="false" @keyup=${this.updateFilteredCommands}>
      <p class="info">${unsafeHTML(this.info)}</p>
      <ul class="commands" @click=${this.click}>
        ${this.filteredCommands.map(t=>html`
          <li class="${this.selected===t?"selected":""}">
            ${t.description}
            <p class="cmd-help">${t.help||t.description}</p>
          </li>
        `)}
      </ul>
    `}static get styles(){return css`
      :host {
        touch-action: manipulation;
        background-color: #eee;
        position: fixed;
        top: 0;
        left: 50%;
        margin-left: -15em;
        width: 30em;
        box-shadow: 0 0.2em 0.7em #bbb;
      }
      :host .cmd-symbol {
        position: absolute;
        border: 1px solid #fff;
        margin: 0.8em;
        font-size: 0.8em;
      }
      :host input {
        display: block;
        margin: 0.5em;
        width: calc(100% - 1em - 0.3em - 1.1em - 2px);
        border: 1px solid #ccc;
        font-size: 0.8em;
        padding: 0.3em;
        padding-left: 1.1em;
      }
      :host p.info {
        font-family: sans-serif;
        font-size: 0.8em;
        margin: 0.4em 0.5em;
        color: #888;
        overflow-wrap: break-word;
      }
      :host p.info .err {
        color: #a65;
      }
      :host .commands {
        user-select: none;
        margin: 0;
        padding: 0;
        font-size: 0.8em;
        font-family: sans-serif;
        list-style-type: none;
      }
      :host .commands li {
        padding: 0.4em 0.5em;
        cursor: pointer;
      }
      :host .commands li:hover {
        background-color: #e9e9e9;
      }
      :host .commands li.selected {
        background-color: #ddd;
      }
      :host p.cmd-help {
        margin: 0.2em 0;
        color: #999;
        font-size: 0.8em;
        display: none;
      }
      :host .selected .cmd-help {
        display: block;
      }
      :host .hidden {
        display: none;
      }
    `}}customElements.define("web-cmd",WebCmd);var _a;let _fetch,clearCache;if("undefined"!=typeof fetch)_fetch=fetch;else {if("undefined"==typeof process||!(null===(_a=process.versions)||void 0===_a?void 0:_a.node))throw new Error("No fetch implementation found for this environment, please post an issue.");{const e=require("path"),t=require("os").homedir();let r;r="darwin"===process.platform?e.join(t,"Library","Caches","jspm"):"win32"===process.platform?e.join(process.env.LOCALAPPDATA||e.join(t,"AppData","Local"),"jspm-cache"):e.join(process.env.XDG_CACHE_HOME||e.join(t,".cache"),"jspm"),clearCache=function(){require("rimraf").sync(e.join(r,"fetch-cache"));};const s=require("make-fetch-happen").defaults({cacheManager:e.join(r,"fetch-cache")}),{fileURLToPath:a}=require("url"),{readFile:i}=require("fs").promises;_fetch=async function(e){if(e.toString().startsWith("file:")||e.toString().startsWith("data:"))try{let t;return t=e.toString().startsWith("file:")?await i(a(e.toString())):decodeURIComponent(e.toString().slice(e.toString().indexOf(","))),{status:200,text:async()=>t.toString(),json:async()=>JSON.parse(t.toString())}}catch(e){return "ENOENT"===e.code?{status:404,statusText:e.toString()}:{status:500,statusText:e.toString()}}return s.apply(this,arguments)};}}let baseUrl;if("undefined"!=typeof process&&process.versions.node)baseUrl=new URL("file://"+process.cwd()+"/");else if("undefined"!=typeof document){const e=document.querySelector("base[href]");e?baseUrl=new URL(e.href+(e.href.endsWith("/")?"":"/")):"undefined"!=typeof location&&(baseUrl=new URL("../",new URL(location.href)));}function decorateError(e,t){const r=e;return r.code=t,r}function deepClone(e){const t=Object.create(null);for(const r of Object.keys(e)){const n=e[r];Array.isArray(n)?t[r]=[...n]:t[r]="object"==typeof n&&null!==n?deepClone(n):n;}return t}function alphabetize(e){const t={};for(const r of Object.keys(e).sort())t[r]=e[r];return t}const defaultStyle={tab:"  ",newline:os.EOL,trailingNewline:os.EOL,indent:"",quote:'"'};function detectStyle(e){let t=Object.assign({},defaultStyle),r=e.match(/\r?\n|\r(?!\n)/);r&&(t.newline=r[0]);let n,a=e.split(t.newline);for(const e of a){const t=e.match(/^\s*[^\s]/);t&&(void 0===n||t.length<n.length)&&(n=t[0].slice(0,-1));}void 0!==n&&(t.indent=n),a=a.map(e=>e.slice(n.length));let o,s=a.map(e=>{var t;return (null===(t=e.match(/^[ \t]*/))||void 0===t?void 0:t[0])||""})||[],i={},c=0;s.forEach(e=>{let t=Math.abs(e.length-c);0!==t&&(i[t]=(i[t]||0)+1),c=e.length;}),Object.keys(i).forEach(e=>{(!o||i[e]>=i[o])&&(o=e);});let l,p={};s.forEach(e=>{let t=e.substr(e.length-o);p[t]=(p[t]||0)+1;}),Object.keys(p).forEach(e=>{(!l||p[e]>p[l])&&(l=e);}),l&&(t.tab=l);let u=e.match(/"|'/);return u&&(t.quote=u[0]),t.trailingNewline=e&&e.match(new RegExp(t.newline+"$"))?t.newline:"",t}function jsonParseStyled(e,t){e.startsWith("\ufeff")&&(e=e.substr(1));let r=detectStyle(e);try{return {json:JSON.parse(e),style:r}}catch(e){throw new Error("Error parsing JSON file"+(t?" "+t:""))}}function jsonStringifyStyled(e,t){let r=JSON.stringify(e,null,t.tab);return t.indent+r.replace(/([^\\])""/g,"$1"+t.quote+t.quote).replace(/([^\\])"/g,"$1"+t.quote).replace(/\n/g,t.newline+t.indent)+(t.trailingNewline||"")}function readHtmlScripts(e,t){const r=parse(e);let n,a=r.find(t=>t.attributes.some(t=>{const{nameStart:r,nameEnd:a,valueStart:o,valueEnd:s}=t;if("type"!==e.slice(r,a))return !1;const i=e.slice(o,s);return "systemjs-importmap"===i||"importmap-shim"===i||"importmap"===i?(n=t,!0):void 0}));a||(a={innerStart:-1,innerEnd:-1,start:-1,end:-1,attributes:[]},n={valueStart:-1,valueEnd:-1});if(a.attributes.some(({nameStart:t,nameEnd:r,valueStart:n,valueEnd:a})=>"src"===e.slice(t,r)&&e.slice(n,a)))throw new Error(t+" references an external import map. Rather install from/to this file directly, or remove the src attribute to use an inline import map.");const o=r.map(t=>{let r,n,a,o,s=-1,i=-1,c=-1,l=-1,p=!1;for(const u of t.attributes)switch(e.slice(u.nameStart,u.nameEnd)){case"src":r||-1===u.valueStart||(a=u.valueStart,o=u.valueEnd,r=e.slice(a,o));break;case"type":void 0===n&&(-1===u.valueStart?(c=u.nameEnd,l=u.nameEnd):(n=e.slice(u.valueStart,u.valueEnd),c=u.nameStart,l=u.valueEnd));break;case"integrity":-1===s&&-1!==u.valueStart&&(s=u.valueStart,i=u.valueEnd);break;case"jspm-cast":p||(p=!0);}if(r||(a=t.innerStart,o=t.innerEnd),!n||"module"===n)return {src:r,type:n,start:t.start,end:t.end,srcStart:a,srcEnd:o,integrityStart:s,integrityEnd:i,typeStart:c,typeEnd:l,jspmCast:p}}).filter(e=>e);return {type:[n.valueStart,n.valueEnd],map:[a.innerStart,a.innerEnd,a.start,a.end],srcScripts:o}}function sort(e){const t={imports:alphabetize(e.imports),scopes:alphabetize(e.scopes),depcache:alphabetize(e.depcache),integrity:alphabetize(e.integrity)};for(const e of Object.keys(t.scopes))t.scopes[e]=alphabetize(t.scopes[e]);return t}function isURL(e){if(e.startsWith("/"))return !0;try{new URL(e);}catch{return !1}return !0}function isPlain(e){return !e.startsWith("./")&&!e.startsWith("../")&&!isURL(e)}function computeIntegrity(e){const t=crypto.createHash("sha384");return t.update(e),"sha384-"+t.digest("base64")}function importedFrom(e){if(!e)return "";let t;return "file:"===e.protocol?t=decodeURIComponent(":"===e.pathname[2]?e.pathname.slice(1):e.pathname):(t=new URL(e.href),t.pathname=t.pathname.replace(/:/g,"%3A").replace(/@/g,"%40"))," imported from "+t}
let resolveQueue,queuePromise=new Promise(e=>resolveQueue=e),queue=[];function log(e,u){if(queue.length)queue.push({type:e,message:u});else {queue=[{type:e,message:u}];const o=resolveQueue;queuePromise=new Promise(e=>resolveQueue=e),o();}}const{SemverRange:SemverRange}=sver;function parseInstallTarget(e){const t=e.indexOf(":"),s="@"===e[t+1];let r=e.indexOf("/",t+1);if(s){if(-1===r)throw new Error("Invalid scoped package name "+e);r=e.indexOf("/",r+1);}return {target:new PackageTarget(e.slice(0,-1===r?e.length:r)),subpath:-1===r?".":"."+e.slice(r)}}class PackageTarget{constructor(e,t){const s=e.indexOf(":");this.registry=s<1?"npm":e.substr(0,s);const r=e.lastIndexOf("@");if(r>s+1){this.name=e.slice(s+1,r);const n=e.slice(r+1);this.ranges=t||SemverRange.isValid(n)?[new SemverRange(n)]:n.split("||").map(e=>convertRange(e));}else -1===s&&t?(this.name=t,this.ranges=SemverRange.isValid(e)?[new SemverRange(e)]:e.split("||").map(e=>convertRange(e))):(this.name=e.slice(s+1),this.ranges=[new SemverRange("*")]);-1===s&&-1!==this.name.indexOf("/")&&"@"!==this.name[0]&&(this.registry="github");const n=this.name.split("/").length;if(n>2||1===n&&"@"===this.name[0])throw new TypeError("Invalid package target "+e)}get registryName(){return `${this.registry}:${this.name}`}toString(){return `${this.registryName}@${this.ranges.map(e=>e.toString()).join(" || ")}`}}function createEsmAnalysis(e,t,s){if(!e.length&&registerRegEx.test(t))throw `Source ${s} is a SystemJS module not an ES Module.`;const r=[],n=[];for(const s of e)if(-1!==s.d){if(s.d>=0){const e=t.slice(s.s,s.e);if(e.startsWith('"')||e.startsWith("'"))try{n.push(JSON.parse('"'+e.slice(1,-1)+'"'));}catch(e){console.warn("TODO: Dynamic import custom expression tracing.");}}}else r.push(t.slice(s.s,s.e));return {deps:r,dynamicDeps:n,size:t.length,integrity:computeIntegrity(t)}}const registerRegEx=/^\s*(\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\s*\/\/[^\n]*)*\s*System\s*\.\s*register\s*\(\s*(\[[^\]]*\])\s*,\s*\(?function\s*\(\s*([^\),\s]+\s*(,\s*([^\),\s]+)\s*)?\s*)?\)/;function createSystemAnalysis(e,t){const[,,,s,,,r]=e.match(registerRegEx)||[];if(!s)throw `Source ${t} is not a SystemJS module.`;const n=JSON.parse(s.replace(/'/g,'"')),o=[];if(r){const t=r+".import(";let s=-1;for(;-1!==(s=e.indexOf(t,s+1));){const r=s+t.length+1,n=e[s+t.length];if('"'===n||"'"===n){const c=e.indexOf(n,s+t.length+1);if(-1!==c)try{o.push(JSON.parse('"'+e.slice(r,c)+'"'));continue}catch(e){}}console.warn("TODO: Dynamic import custom expression tracing.");}}return {deps:n,dynamicDeps:o,size:e.length,integrity:computeIntegrity(e)}}function getExportsTarget(e,t){if("string"==typeof e)return e;if("object"!=typeof e||null===e||Array.isArray(e)){if(Array.isArray(e))for(const s of e)return getExportsTarget(s,t)}else for(const s in e)if("default"===s||t.includes(s)){const r=getExportsTarget(e[s],t);if(r)return r}return null}async function analyze(e,t,s=!1){const r=await _fetch(e);switch(r.status){case 200:case 304:break;case 404:throw new Error(`Module not found: ${e}${importedFrom(t)}`);default:throw new Error(`Invalid status code ${r.status} loading ${e}. ${r.statusText}`)}let n=await r.text();try{const[t]=await lexer.parse(n);return s?createSystemAnalysis(n,e):createEsmAnalysis(t,n,e)}catch(r){if(!r.message||!r.message.startsWith("Parse error @:"))throw r;const o=await _fetch(e);switch(o.status){case 200:case 304:break;case 404:throw new Error(`Module not found: ${e}${importedFrom(t)}`);default:throw new Error(`Invalid status code ${o.status} loading ${e}. ${o.statusText}`)}n=await o.text();try{const[t]=await lexer.parse(n);return s?createSystemAnalysis(n,e):createEsmAnalysis(t,n,e)}catch(t){if(t.message&&t.message.startsWith("Parse error @:")){const s=t.message.slice(14,t.message.indexOf("\n"));let[r,o]=s.split(":");const c=n.split("\n");throw r>1&&console.log("  "+c[r-2]),console.log("> "+c[r-1]),console.log("  "+" ".repeat(o-1)+"^"),c.length>1&&console.log("  "+c[r]),new Error(`Error parsing ${e}:${s}`)}throw t}}}function importMapToResolutions(e,t,s){const r={imports:Object.create(null),scopes:Object.create(null),depcache:e.depcache,integrity:Object.create(null)},n={imports:Object.create(null),scopes:Object.create(null)};function o(e,o){const c=!0===o?esmCdnUrl+"/":o?pkgToUrl(o,esmCdnUrl)+"/":void 0;for(const[o,i]of Object.entries(e)){const e=parsePkg(o);if(e&&null!==i){const{pkgName:r,subpath:o}=e,a=parseCdnPkg(new URL(i,t));if(a){const e=a.path;delete a.path;let t=(c?n.scopes[c]=n.scopes[c]||Object.create(null):n.imports)[r];if(!t||pkgEq(t.pkg,a)||s.clean){t=t||((c?n.scopes[c]:n.imports)[r]={pkg:a,exports:Object.create(null)}),t.exports[o]="."+e;continue}}}(c?r.scopes[c]=r.scopes[c]||Object.create(null):r.imports)[o]=i;}}o(e.imports);for(const n of Object.keys(e.scopes)){const c=new URL(n,t);if(c.href.startsWith(systemCdnUrl)||c.href.startsWith(esmCdnUrl)){if(c.href===esmCdnUrl||c.href===systemCdnUrl){o(e.scopes[n],!0);continue}const t=parseCdnPkg(c);if(t&&"/"===t.path){o(e.scopes[n],t);continue}if(s.clean)continue}const i=r.scopes[n]=r.scopes[n]||Object.create(null);Object.assign(i,e.scopes[n]);}return [n,r]}function resolutionsToImportMap(e,t,s){const r={imports:Object.create(null),scopes:Object.create(null),depcache:Object.create(null),integrity:Object.create(null)};for(const[n,{pkg:o,exports:c}]of Object.entries(e.imports))for(const[e,i]of Object.entries(c)){const c=n+e.slice(1);s&&!s.has(c)||(r.imports[c]=pkgToUrl(o,t)+i.slice(1));}for(const[n,o]of Object.entries(e.scopes)){if(!n.startsWith(esmCdnUrl))throw new Error("Internal error.");const e=Object.create(null),c=t+n.slice(esmCdnUrl.length);for(const[r,{pkg:n,exports:i}]of Object.entries(o))for(const[o,a]of Object.entries(i)){const i=r+o.slice(1);s&&!s.has(c.slice(t.length)+"|"+i)||(e[i]=pkgToUrl(n,t)+a.slice(1));}Object.keys(e).length&&(r.scopes[c]=e);}return r}function parsePkg(e){let t=e.indexOf("/");if("@"===e[0]){if(-1===t)return;t=e.indexOf("/",t+1);}return -1===t?{pkgName:e,subpath:"."}:{pkgName:e.slice(0,t),subpath:"."+e.slice(t)}}function pkgToStr(e){return `${e.registry}:${e.name}${e.version?"@"+e.version:""}`}function pkgToLookupUrl(e,t=!1){return `https://ga.jspm.io/${e.registry}:${e.name}${e.version?"@"+e.version:t?"@":""}`}const esmCdnUrl="https://ga.jspm.io/";const systemCdnUrl="https://ga.system.jspm.io/";function pkgEq(e,t){return e.registry===t.registry&&e.name===t.name&&e.version===t.version}function matchesTarget(e,t){return e.registry===t.registry&&e.name===t.name&&t.ranges.some(t=>t.has(e.version,!0))}function pkgToUrl(e,t){return t+pkgToStr(e)}const exactPkgRegEx=/^([a-z]+):((?:@[^/\\%@]+\/)?[^./\\%@][^/\\%@]*)@([^\/]+)(\/.*)?$/;function parseCdnPkg(e){const t=e.href;let s,r,n,o;if(t.startsWith(esmCdnUrl)&&([,s,r,n,o]=t.slice(esmCdnUrl.length).match(exactPkgRegEx)||[]),t.startsWith(systemCdnUrl)&&([,s,r,n,o]=t.slice(systemCdnUrl.length).match(exactPkgRegEx)||[]),s)return {registry:s,name:r,version:n,path:o}}const scopeCache=new WeakMap;function getScopeMatches(e,t,s){const r=e.href;let n=scopeCache.get(t);return n||(n=Object.keys(t).map(e=>[e,new URL(e,s).href]),n=n.sort(([,e],[,t])=>e.length<t.length?1:-1),scopeCache.set(t,n)),n.filter(([,e])=>e===r||e.endsWith("/")&&r.startsWith(e))}function getMapMatch(e,t){if(e in t)return e;let s;for(const r of Object.keys(t))r.endsWith("/")&&e.startsWith(r)&&(!s||r.length>s.length)&&(s=r);return s}
const{Semver:Semver,SemverRange:SemverRange$1}=sver;class Installer{constructor(t,e){this.pageBaseUrl=baseUrl,this.resolveCache={},this.pcfgPromises=Object.create(null),this.pcfgs=Object.create(null),this.tracedUrls=Object.create(null),this.tracedMappings=new Set,this.resolvedExportsCache=new WeakMap,this.completed=!1,this.traceMap=t,this.mapBaseUrl=this.traceMap.baseUrl,this.opts=e,this.opts.clean&&(this.opts.full=!0),this.conditions=t.conditions,[this.installs,this.map]=importMapToResolutions(this.traceMap.map,this.mapBaseUrl,e);}complete(){if(this.opts.depcache){this.opts.clean&&(this.map.depcache=Object.create(null));for(const[t,e]of Object.entries(this.tracedUrls))e.length&&(this.map.depcache[t]=e);}this.traceMap.set(sort(this.map));const t=sort(resolutionsToImportMap(this.installs,this.opts.system?systemCdnUrl:esmCdnUrl,this.opts.clean?this.tracedMappings:null));this.traceMap.extend(t),this.opts.flatten&&this.traceMap.flatten(),this.completed=!0;}async add(t,e){if(e&&e.endsWith("/")&&(e=e.slice(0,-1)),this.completed)throw new Error("New install instance needed.");if(t.startsWith("./")||t.startsWith("../")||isURL(t)){const s=new URL(t,this.pageBaseUrl);return await this.trace(s.href,!1,this.pageBaseUrl),void(e&&(this.map.imports[e]=this.traceMap.baseUrlRelative(s)))}const{target:s,subpath:r}=parseInstallTarget(t),o=e&&r;e||(e=s.name);const a=await this.resolveLatestTarget(s);log("install",`${e} ${pkgToStr(a)}`);const i={pkgName:e},n=this.setResolution(i,a);let c;if(this.opts.installExports){const t=await this.getPackageConfig(a);c=Object.fromEntries(Object.keys(await this.resolveExports(a,t)).filter(t=>!t.endsWith("!cjs")).map(t=>[t,t]));}else if("."===r){const t=await this.getPackageConfig(a),e=Object.fromEntries(Object.keys(await this.resolveExports(a,t)).filter(t=>!t.endsWith("!cjs")).map(t=>[t,t]));e[r]||(c=e);}else if("./"===r){const t=await this.getPackageConfig(a),e=Object.fromEntries(Object.keys(await this.resolveExports(a,t)).filter(t=>!t.endsWith("!cjs")).map(t=>[t,t]));e[r]||(c=e);}c=c||{[o?".":r]:r};for(const t of Object.keys(c))this.tracedMappings.add(i.pkgName+t.slice(1));await this.tracePkg(a,c,n,!0,!1);}setResolution(t,e){if(t.pkgScope){const s=this.installs.scopes[t.pkgScope]=this.installs.scopes[t.pkgScope]||Object.create(null);let r=s[t.pkgName];return r?r.pkg=e:r=s[t.pkgName]={pkg:e,exports:Object.create(null)},r.exports}{let s=this.installs.imports[t.pkgName];return s?s.pkg=e:s=this.installs.imports[t.pkgName]={pkg:e,exports:Object.create(null)},s.exports}}async resolveExports(t,e,s=!1){const r=this.resolvedExportsCache.get(e);if(r)return r;let o=this.conditions;o=s?["require",...this.conditions.filter(t=>"import"!==t)]:["import",...this.conditions.filter(t=>"require"!==t)];const a={};if(void 0!==e.exports&&null!==e.exports){if("string"==typeof e.exports)a["."]=e.exports;else if(function(t){for(let e in t)if("."!==e[0])return !1;return !0}(e.exports))for(const t of Object.keys(e.exports))a[t]=getExportsTarget(e.exports[t],o);else a["."]=getExportsTarget(e.exports,o);}else {if("string"==typeof e.browser?a["."]=e.browser.startsWith("./")?e.browser:"./"+e.browser:"string"==typeof e.main&&(a["."]=e.main.startsWith("./")?e.main:"./"+e.main),"object"==typeof e.browser)for(const t of Object.keys(e.browser))t.startsWith("./")?(a["."]===t&&(a["."]=e.browser[t]),a[t]=e.browser[t]):log("todo",`Non ./ subpaths in browser field: ${e.name}.browser['${t}'] = ${e.browser[t]}`);a["./"]||(a["./"]="./"),a["."]||(a["."]=".");}return this.resolvedExportsCache.set(e,a),a}async getPackageConfig(t){const e=pkgToStr(t);let s=this.pcfgs[e];return s||(await(this.pcfgPromises[e]=this.pcfgPromises[e]||(async()=>{const s=await _fetch(pkgToLookupUrl(t)+"/package.json");switch(s.status){case 200:case 304:break;case 404:throw new Error(`Package ${e} not found.`);default:throw new Error(`Invalid status code ${s.status} reading package config for ${e}. ${s.statusText}`)}this.pcfgs[e]=await s.json();})()),this.pcfgs[e])}async getInstalledPackages(t){return []}getBestMatch(t){}upgradePackagesTo(t,e){if(this.opts.lock)return;const s=new Semver(e.version);let r=!1;const o=new Set;for(const e of new Set(t.map(({pkg:t})=>t.version))){let a=!0;for(const{pkg:r,target:o}of t)r.version===e&&((this.opts.force||o.ranges.some(t=>t.has(r.version,!0)))&&!s.lt(r.version)&&o.ranges.some(t=>t.has(s,!0))||(a=!1));if(a&&(r=!0),r||this.opts.latest)for(const{pkg:s,install:r}of t){if(s.version!==e)continue;const t=this.setResolution(r,s);for(const e of Object.keys(t))o.add(e);}}return this.opts.latest||r?[...o]:void 0}isNodeCorePeer(t){return -1!==["assert","async_hooks","buffer","child_process","cluster","console","constants","crypto","dgram","dns","domain","events","fs","http","http2","https","inspector","module","net","os","path","perf_hooks","process","punycode","querystring","readline","repl","stream","string_decoder","sys","timers","tls","tty","url","util","vm","worker_threads","zlib"].indexOf(t)}async traceInstall(t,e,s){var r,o,a,i,n,c,l;if(log("trace",`${t} ${e}`),!isPlain(t)){const r=new URL(t,e);return this.trace(r.href,s,e)}const p=parsePkg(t);if(!p)throw new Error("Invalid package name "+t);const{pkgName:h,subpath:g}=p,d=parseCdnPkg(e),m=d?pkgToUrl(d,esmCdnUrl)+"/":void 0;if(d&&m){this.tracedMappings.add(m.slice(esmCdnUrl.length)+"|"+t);const c=getScopeMatches(e,this.map.scopes,this.mapBaseUrl);if(c.filter(([,t])=>t.startsWith(m)).length)throw new Error("TODO: Support custom user subscopes.");if(!this.installs.scopes[m]){if(c.some(([,t])=>!t.startsWith(m)))throw new Error("TODO: Support custom user package scope scopes.");if(this.installs.scopes[esmCdnUrl])throw new Error("TODO: Reading flattened scopes");if(getMapMatch(t,this.map.imports))throw new Error("TODO: Custom user import")}const l=await this.getPackageConfig(d);if(h===l.name&&null!==l.exports&&void 0!==l.exports){const t=new PackageTarget(d.version,d.name);return this.installPkg(h,m,t,{[g]:g},s,e)}if(null===(r=l.dependencies)||void 0===r?void 0:r[h]){const t=new PackageTarget(l.dependencies[h],h);return this.installPkg(h,m,t,{[g]:g},s,e)}if(null===(o=l.peerDependencies)||void 0===o?void 0:o[h]){const r=new PackageTarget(l.peerDependencies[h],h);return this.tracedMappings.add(t),this.installPkg(h,void 0,r,{[g]:g},s,e)}if(null===(a=l.optionalDependencies)||void 0===a?void 0:a[h]){const r=new PackageTarget(l.optionalDependencies[h],h);return this.tracedMappings.add(t),this.installPkg(h,void 0,r,{[g]:g},s,e)}if(h===l.name){const t=this.setResolution({pkgName:h,pkgScope:m},d);return this.tracePkg(d,{[g]:g},t,!1,s,e)}if(this.isNodeCorePeer(t)&&"."===g){this.tracedMappings.add(t);const r=new PackageTarget("@jspm/core@2",h);let o=null===(n=m&&(null===(i=this.installs.scopes[m])||void 0===i?void 0:i[h])||this.installs.imports[h])||void 0===n?void 0:n.pkg;const a=o&&(this.opts.lock||!matchesTarget(o,r));if(!a){const t=this.getBestMatch(r),s=await this.resolveLatestTarget(r,e),a=await this.getInstalledPackages(r);o=this.upgradePackagesTo(a,s)||!t||this.opts.latest?s:t;}const c=this.setResolution({pkgName:h,pkgScope:void 0},o),l=await this.resolveExports(o,await this.getPackageConfig(o)),p=pkgToUrl(o,esmCdnUrl);return c["."]=a&&c["."]||l["./nodelibs/"+t]||"./nodelibs/@empty.js",this.trace(p+c["."].slice(1),s,e)}console.warn(`Package ${t} not declared in package.json dependencies - installing from latest${importedFrom(e)}`);const p=new PackageTarget("*",h);return this.installPkg(h,m,p,{[g]:g},s,e)}{this.tracedMappings.add(t);const r=getMapMatch(t,this.map.imports),o=this.installs.imports[h];if(r&&o)throw new Error("TODO: deconflicting between user and resolution imports resolutions for "+t);if(r){const o=new URL(this.map.imports[r]+g.slice(1+Number(r.endsWith("/"))),this.mapBaseUrl);return "https://jspm.dev"===o.origin?(delete this.map.imports[r],this.add(o.pathname.slice(1),t)):this.trace(o.href,s,e)}if(o)return this.tracePkg(o.pkg,Object.fromEntries(Object.keys(o.exports).map(t=>[t,t])),o.exports,!1,s,e);if(this.isNodeCorePeer(t)&&"."===g){const r=new PackageTarget("@jspm/core@2",h);let o=null===(l=m&&(null===(c=this.installs.scopes[m])||void 0===c?void 0:c[h])||this.installs.imports[h])||void 0===l?void 0:l.pkg;const a=o&&(this.opts.lock||!matchesTarget(o,r));if(!a){const t=this.getBestMatch(r),s=await this.resolveLatestTarget(r,e),a=await this.getInstalledPackages(r);o=this.upgradePackagesTo(a,s)||!t||this.opts.latest?s:t;}const i=this.setResolution({pkgName:h,pkgScope:void 0},o),n=await this.resolveExports(o,await this.getPackageConfig(o)),p=pkgToUrl(o,esmCdnUrl);return i["."]=a&&i["."]||n["./nodelibs/"+t]||"./nodelibs/@empty.js",this.trace(p+i["."].slice(1),s,e)}if(h){const t=new PackageTarget("*",h);return this.installPkg(h,m,t,{[g]:g},s,e)}throw new Error("TODO: Can this branch ever happen?")}}async installPkg(t,e,s,r,o,a){var i,n;let c=null===(n=e?null===(i=this.installs.scopes[e])||void 0===i?void 0:i[t]:this.installs.imports[t])||void 0===n?void 0:n.pkg;if(!(c&&(this.opts.lock||matchesTarget(c,s)))){const o=this.getBestMatch(s),i=await this.resolveLatestTarget(s,a),n=await this.getInstalledPackages(s),l=this.upgradePackagesTo(n,i);if(c=l||!o||this.opts.latest?i:o,log("install",`${t} ${pkgToStr(c)}${e?" ["+pkgToStr(parseCdnPkg(new URL(e)))+"]":""}`),l)for(const t of l||[])r[t]||(r[t]=t);}const l=this.setResolution({pkgName:t,pkgScope:e},c);return this.tracePkg(c,r,l,!1,o,a)}async tracePkg(t,e,s,r,o,a){await Promise.all(Object.keys(e).map(async i=>{const n=e[i];let c=s,l=getMapMatch(n,s);if(!l){const e=await this.resolveExports(t,await this.getPackageConfig(t),o);l=getMapMatch(n,e),l&&(c=e);}if(!l)throw console.log((await this.getPackageConfig(t)).exports),console.log(`No package exports defined for ${n} in ${pkgToStr(t)}${importedFrom(a)}`),new Error(`No package exports defined for ${n} in ${pkgToStr(t)}${importedFrom(a)}`);const p=c[l],h=n.slice(l.length);r?s[i]=p+h:s[l]=p;let g=pkgToUrl(t,esmCdnUrl)+p.slice(1)+h;return !o&&c[p+h+"!cjs"]&&(o=!0),this.trace(g,o,a)}));}async trace(t,e,s){if(this.tracedUrls[t])return;if(t.endsWith("/")){const r=parseCdnPkg(new URL(t));if(!r)throw new Error("TODO: subpath exports for non packages");const o=await this.getPackageConfig(r),a=await this.resolveExports(r,o),i=Object.create(null);for(const e of Object.keys(a))if(!e.endsWith("!cjs")&&e.startsWith("."+r.path)){if(e.endsWith("/"))throw new Error(`TODO: trace directory listing / trace package dependency deoptimizations, importing ${t}${importedFrom(s)}`);i[e]=e;}return void await this.tracePkg(r,i,a,!0,e,s)}const r=this.tracedUrls[t]=[],{deps:o,dynamicDeps:a}=await analyze(t,s,!t.startsWith(esmCdnUrl)&&this.opts.system);if(a.length)for(const t of a)-1===o.indexOf(t)&&o.push(t);const i=new URL(t);await Promise.all(o.map(t=>(r.push(t),this.traceInstall(t,i,e))));}async resolveLatestTarget(t,e){const{registry:s,name:r,ranges:o}=t;if(1===o.length&&o[0].isExact&&!o[0].version.tag)return {registry:s,name:r,version:o[0].version.toString()};const a=this.resolveCache[t.registryName]=this.resolveCache[t.registryName]||{latest:null,majors:Object.create(null),minors:Object.create(null),tags:Object.create(null)};for(const t of o.reverse())if(t.isWildcard){const t=await(a.latest||(a.latest=this.lookupRange(s,r,"",e)));if(t)return t}else if(t.isExact&&t.version.tag){const o=t.version.tag,i=await(a.tags[o]||(a.tags[o]=this.lookupRange(s,r,o,e)));if(i)return i}else if(t.isMajor){const o=t.version.major,i=await(a.majors[o]||(a.majors[o]=this.lookupRange(s,r,o,e)));if(i)return i}else if(t.isStable){const o=`${t.version.major}.${t.version.minor}`,i=await(a.minors[o]||(a.minors[o]=this.lookupRange(s,r,o,e)));if(i)return i}throw new Error(`Unable to resolve package ${s}:${r} to "${o.join(" || ")}"${importedFrom(e)}`)}async lookupRange(t,e,s,r){const o=await _fetch(pkgToLookupUrl({registry:t,name:e,version:s}));switch(o.status){case 304:case 200:return {registry:t,name:e,version:(await o.text()).trim()};case 404:return null;default:throw new Error(`Invalid status code ${o.status} looking up "${t}:${e}" - ${o.statusText}${importedFrom(r)}`)}}}
const Pool=(t=1)=>class{constructor(){this.c=0,this.q=[];}async job(){++this.c>t&&await new Promise(t=>this.q.push(t));}next(){this.c--,this.q.pop();}};class TraceMap{constructor(t,e,s){this._baseUrl=baseUrl,this._map={imports:Object.create(null),scopes:Object.create(null),integrity:Object.create(null),depcache:Object.create(null)},this.conditions=["browser","development"],this._p=new(Pool(1)),this.mapStyle=defaultStyle,"string"==typeof e&&({json:e,style:this.mapStyle}=jsonParseStyled(e)),"object"==typeof e&&this.extend(e,!0),t&&(t instanceof URL||(this._baseUrl=new URL(t+(t.endsWith("/")?"":"/"),baseUrl))),s&&(this.conditions=s);}set(t){return this._map.imports=t.imports||Object.create(null),this._map.scopes=t.scopes||Object.create(null),this._map.integrity=t.integrity||Object.create(null),this._map.depcache=t.depcache||Object.create(null),this}remove(t){return !!this._map.imports[t]&&(delete this._map.imports[t],!0)}extend(t,e=!1){if(t.imports&&Object.assign(this._map.imports,t.imports),t.scopes)if(e)Object.assign(this._map.scopes,t.scopes);else for(const e of Object.keys(t.scopes))Object.assign(this._map.scopes[e]=this._map.scopes[e]||Object.create(null),t.scopes[e]);return t.integrity&&Object.assign(this._map.integrity,t.integrity),t.depcache&&Object.assign(this._map.depcache,t.depcache),this}baseUrlRelative(t){const e=t.origin,s=t.href,i=this._baseUrl.href;if(s.startsWith(i))return "./"+s.slice(i.length);if(e!==this._baseUrl.origin||!s.startsWith(e)||!i.startsWith(e))return t.href;const a=this._baseUrl.pathname,r=t.pathname,n=Math.min(a.length,r.length);let o=-1;for(let t=0;t<n&&a[t]===r[t];t++)"/"===r[t]&&(o=t);return "../".repeat(a.slice(o+1).split("/").length)+r.slice(o+1)+t.search+t.hash}get baseUrl(){return this._baseUrl}get map(){return deepClone(this._map)}copy(t){if("undefined"==typeof document)throw new Error("Node.js clipboard support pending.");const e=this.toString(t),s=document.createElement("textarea");return s.value=e,document.body.appendChild(s),s.select(),document.execCommand("copy"),document.body.removeChild(s),this}toString(t){const e={};return Object.keys(this._map.imports).length&&(e.imports=this._map.imports),Object.keys(this._map.scopes).length&&(e.scopes=this._map.scopes),Object.keys(this._map.integrity).length&&(e.integrity=this._map.integrity),Object.keys(this._map.depcache).length&&(e.depcache=this._map.depcache),jsonStringifyStyled(e,t?Object.assign(this.mapStyle,{indent:"",tab:"",newline:""}):this.mapStyle)}rebase(t=this._baseUrl.href){const e=this._baseUrl;this._baseUrl=new URL(t,baseUrl),this._baseUrl.pathname.endsWith("/")||(this._baseUrl.pathname+="/");for(const t of Object.keys(this._map.imports)){const s=this._map.imports[t];null!==s&&(this._map.imports[t]=this.baseUrlRelative(new URL(s,e)));}for(const t of Object.keys(this._map.scopes)){const s=this._map.scopes[t];for(const t of Object.keys(s)){const i=s[t];null!==i&&(this._map.imports[t]=this.baseUrlRelative(new URL(i,e)));}}const s=Object.create(null);for(const t of Object.keys(this._map.depcache)){const i=this._map.depcache[t].map(t=>isPlain(t)?t:this.baseUrlRelative(new URL(t,e)));s[this.baseUrlRelative(new URL(t,e))]=i;}this._map.depcache=s;const i=Object.create(null);for(const t of Object.keys(this._map.integrity)){const s=this._map.integrity[t];i[this.baseUrlRelative(new URL(t,e))]=s;}return this._map.integrity=i,this}flatten(){for(const t of Object.keys(this._map.scopes)){const e=new URL(t,this._baseUrl);let s,i;if("file:"!==e.protocol&&(e.origin===this._baseUrl.origin&&e.href.startsWith(this._baseUrl.origin)?i="/":e.href.startsWith(e.origin)&&(i=e.origin+"/"),i&&(s=this._map.scopes[i]||{})),!s)continue;const a=this._map.scopes[t];let r=!0;for(const t of Object.keys(a)){const e=s[t],n=a[t];if(null===n)continue;const o=new URL(n,this._baseUrl);e&&new URL(e,this._baseUrl).href!==o.href?r=!1:(s[t]=this.baseUrlRelative(o),delete a[t],this._map.scopes[i]=alphabetize(s));}r&&delete this._map.scopes[t];}for(const t of Object.keys(this._map.depcache))0===this._map.depcache[t].length&&delete this._map.depcache[t];return this}sort(){return this._map=sort(this._map),this}clearIntegrity(){this._map.integrity=Object.create(null);}clearDepcache(){this._map.depcache=Object.create(null);}setIntegrity(t,e){this._map.integrity[t]=e;}sortIntegrity(){this._map.integrity=alphabetize(this._map.integrity);}async trace(t,e=!1,s=!1){let i=0;const a=new Set,r=async(t,n,c,l,p)=>{const h=this.resolve(t,n);if(l[t]=h,null===h)return;const m=h.href;if(c[m])return;if(o[m])return;if(s&&p){const e=this.baseUrlRelative(n),s=this._map.depcache[e];s?s.includes(t)||s.push(t):this._map.depcache[e]=[t];}const f=c[m]={deps:Object.create(null),dynamicDeps:Object.create(null),dynamicOnly:p,size:NaN,order:NaN,integrity:""},{deps:y,dynamicDeps:d,size:_,integrity:b}=await analyze(m,n,e);f.integrity=b,f.size=_;for(const t of y)await r(t,h,c,f.deps,p);for(const t of d)p?await r(t,h,c,f.dynamicDeps,!0):a.add({dep:t,parentUrl:h});f.order=i++;},n=Object.create(null),o=Object.create(null);for(const e of t)await r(e,this._baseUrl,o,n,!1);for(const{dep:t,parentUrl:e}of a){const s=Object.create(null);await r(t,e,s,n,!0);for(const t of Object.keys(s))o[t]||(o[t]=s[t]);}return {map:n,trace:o}}async traceInstall(t,e={}){"string"==typeof t&&(t=[t]),Array.isArray(t)||(e={lock:!0,...t||{}},t=Object.keys(this._map.imports)),await this._p.job();try{const s=new Installer(this,e);await Promise.all(t.map(t=>s.traceInstall(t,this._baseUrl,!1))),s.complete();}finally{this._p.next();}return this}async install(t={},e){t.lock=!0,await this._p.job(),!1!==t.clean&&(t.clean=!0);try{const s=new Installer(this,t);for(const t of e||Object.keys(this._map.imports))await s.traceInstall(t,this._baseUrl,!1);s.complete();}finally{this._p.next();}return this}async add(t,e={}){"string"==typeof t&&(t=[t]),await this._p.job();try{const s=new Installer(this,e);await Promise.all(t.map(t=>{if("string"==typeof t&&!isPlain(t)){const e=t.split("/").pop(),s=e.lastIndexOf(".");t={name:-1===s?e:e.slice(0,s),target:t};}return "string"==typeof t?s.add(t):s.add(t.target,t.name)})),s.complete();}finally{this._p.next();}return this}async upgrade(t,e={}){if("string"==typeof t&&(t=[t]),Array.isArray(t)||(t&&(e=t),t=Object.keys(this._map.imports)),0===t.length)throw new Error("No packages to upgrade.");for(const e of t){if(!this._map.imports[e])throw new Error(`Cannot upgrade package ${e} as it is not a top-level "imports" entry.`);delete this._map.imports[e];}this.add(t,e);}uninstall(t,e=!1){if("string"==typeof t&&(t=[t]),0===t.length)throw new Error("No packages provided to uninstall.");for(const e of t){if(!this._map.imports[e])throw new Error(`Cannot uninstall package ${e} as it is not a top-level "imports" entry.`);delete this._map.imports[e];}this.traceInstall({clean:!0,force:e});}async installToConditions(t){this.conditions=t,await this.traceInstall({clean:!0});}resolve(t,e){return resolve(t,e,this._map,this._baseUrl)}}function resolve(t,e,s,i){if(!isPlain(t))return new URL(t,e);const a=getScopeMatches(e,s.scopes,i);for(const[e]of a){const a=getMapMatch(t,s.scopes[e]);if(a){const r=s.scopes[e][a];return null===r?null:new URL(r+t.slice(a.length),i)}}const r=getMapMatch(t,s.imports);if(r){const e=s.imports[r];return null===e?null:new URL(e+t.slice(r.length),i)}throw decorateError(new Error(`Unable to resolve "${t}" from ${e.href}`),"MODULE_NOT_FOUND")}const sandbox=document.querySelector("jspm-sandbox"),editor=document.querySelector("jspm-sandbox").shadowRoot.querySelector("jspm-editor");function getOffset(e,t,n,a){return {start:e.slice(0,t).split("\n").length,lines:a.split("\n").length-n.split("\n").length}}const webcmd=new WebCmd([{name:"install",description:"Lock Install",help:"Runs and creates the full verification locked import map",async run(){let e=editor.getContents();const t=readHtmlScripts(e),n=e.slice(t.map[0],t.map[1]),a=JSON.parse(n),r=[...Object.keys(a.imports||{}),...t.srcScripts.filter(e=>!e.src).map(t=>"data:application/javascript,"+encodeURIComponent(e.slice(t.srcStart,t.srcEnd)))],s=new TraceMap(window.location.href,a);await s.install({},r);const o="\n"+s.toString();return e=e.slice(0,t.map[0])+o+e.slice(t.map[1]),editor.setContents(e,getOffset(e,t.map[0],n,o)),{title:"jspm",innerHTML:"Successfully installed"}}},{name:"add",description:"Add a package",help:"Add a new package to the HTML import map",validate(...e){if(!e.length)return "Must provide a package name to add."},async run(e){let t=editor.getContents();const n=readHtmlScripts(t),a=t.slice(n.map[0],n.map[1]),r=JSON.parse(a),s=new TraceMap(window.location.href,r);await s.add(e);const o="\n"+s.toString();return t=t.slice(0,n.map[0])+o+t.slice(n.map[1]),editor.setContents(t,getOffset(t,n.map[0],a,o)),{title:"jspm",innerHTML:"Added "+e}}},{name:"remove",description:"Remove a package",help:"Remove a package from the HTML importmap",async run(e){let t=editor.getContents();const n=readHtmlScripts(t),a=t.slice(n.map[0],n.map[1]),r=JSON.parse(a),s=new TraceMap(window.location.href,r);await s.remove(e);const o="\n"+s.toString();return t=t.slice(0,n.map[0])+o+t.slice(n.map[1]),editor.setContents(t,getOffset(t,n.map[0],a,o)),{title:"jspm",innerHTML:"Removed "+e}}},{name:"run",description:"Run",help:"Execute the sandbox HTML code (Ctrl+S)",async run(){sandbox.run(),editor.editor.focus();}}]);webcmd.show(),webcmd.addEventListener("hide",()=>editor.editor.focus()),Object.assign(webcmd.style,{"z-index":"1000","margin-top":"3.5em"}),document.querySelector(".container").appendChild(webcmd);}}});