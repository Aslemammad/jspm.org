<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>Conditional Loading | jspm 0.17 Beta Guide</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.6.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="gitbook/style.css">
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-highlight/website.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-search/search.css">
        
    
        
        <link rel="stylesheet" href="gitbook/plugins/gitbook-plugin-fontsettings/website.css">
        
    
    

        
    
    
    <link rel="next" href="./conditional-substitution.html" />
    
    
    <link rel="prev" href="./overrides.html" />
    

        
    </head>
    <body>
        
        
    <div class="book"
        data-level="16"
        data-chapter-title="Conditional Loading"
        data-filepath="conditional-loading.md"
        data-basepath="."
        data-revision="Mon Feb 27 2017 09:57:14 GMT+0200 (SAST)"
        data-innerlanguage="">
    

<div class="book-summary">
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="1" data-path="creating-a-project.html">
            
                
                    <a href="./creating-a-project.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        Creating a Project
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="development-bundling.html">
            
                
                    <a href="./development-bundling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Development Bundling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="hot-reloading.html">
            
                
                    <a href="./hot-reloading.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        Hot-Reloading
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="package-configuration.html">
            
                
                    <a href="./package-configuration.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        Package Configuration
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="installing-the-jsx-babel-plugin.html">
            
                
                    <a href="./installing-the-jsx-babel-plugin.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        Installing the JSX Babel Plugin
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="universal-js-with-server-rendering.html">
            
                
                    <a href="./universal-js-with-server-rendering.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Universal JS with Server Rendering
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="npm-package-support.html">
            
                
                    <a href="./npm-package-support.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        npm Package Support
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="bundling.html">
            
                
                    <a href="./bundling.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        Bundling
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="loading-libraries-from-cdn.html">
            
                
                    <a href="./loading-libraries-from-cdn.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        Loading Libraries from CDN
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="custom-package-resolutions.html">
            
                
                    <a href="./custom-package-resolutions.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        Custom Package Resolutions
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="static-builds-with-rollup-optimization.html">
            
                
                    <a href="./static-builds-with-rollup-optimization.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        Static Builds with Rollup Optimization
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="publishing.html">
            
                
                    <a href="./publishing.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        Publishing
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="peer-dependencies.html">
            
                
                    <a href="./peer-dependencies.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        Peer Dependencies
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="linking.html">
            
                
                    <a href="./linking.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        Linking
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="overrides.html">
            
                
                    <a href="./overrides.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        Overrides
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="16" data-path="conditional-loading.html">
            
                
                    <a href="./conditional-loading.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        Conditional Loading
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="conditional-substitution.html">
            
                
                    <a href="./conditional-substitution.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        Conditional Substitution
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >jspm 0.17 Beta Guide</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h2 id="conditional-loading">Conditional Loading</h2>
<p>Conditional loading is supported in SystemJS and jspm 0.17 at the module tree level instead of through code
conditionals.</p>
<p>The benefit of this approach is that conditional loading becomes a natural extension of the module
resolution process. SystemJS Builder is designed to handle conditional build trees
so that we can choose to build all possible conditional branches or just the branches we want by passing
the <code>conditionals</code> build option.</p>
<blockquote>
<p>The features shown in this section are SystemJS features more than jspm features, with SystemJS Builder
  doing all of the real work for us here.</p>
</blockquote>
<p>So for a rather contrived example, let&apos;s say we wanted our <code>Hello World</code> text to include a note as to whether
we are running in production or development.</p>
<p>We rewrite the <code>src/component.js</code> file to import its text from a separate file:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;react&apos;</span>;
<span class="hljs-keyword">import</span> text <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;./text.js&apos;</span>;
<span class="hljs-keyword">export</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">HelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">React</span>.<span class="hljs-title">Component</span> </span>{
  render() {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">h1</span>&gt;</span>{text}<span class="hljs-tag">&lt;/<span class="hljs-title">h1</span>&gt;</span>;</span>
  }
}
</code></pre>
<p>Where <code>src/text.js</code> contains:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&apos;Hello World - Production&apos;</span>;
</code></pre>
<p>Now to create a separate implementation of the <code>text.js</code> file for development, edit <code>src/text-dev.js</code>:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-string">&apos;Hello World - Development&apos;</span>;
</code></pre>
<p>If we load the app, we will get the production version by default.</p>
<p>To inform SystemJS to use the development version in development we can edit the package configuration
(as we did in the <a href="package-configuration.html">Package Configuration</a> section) in <code>jspm.config.js</code>
to include a <em>conditional package map</em>:</p>
<pre><code class="lang-javascript">SystemJS.config({
  ...

  packages: {
    <span class="hljs-string">&quot;jspm-react-component&quot;</span>: {
      ...

      <span class="hljs-string">&quot;map&quot;</span>: {
        <span class="hljs-string">&quot;./text.js&quot;</span>: {
          <span class="hljs-string">&quot;~production&quot;</span>: <span class="hljs-string">&quot;./text-dev.js&quot;</span>
        }
      }
    },

    ...
  }
});
</code></pre>
<p>The <code>~production</code> syntax above means the <em>NOT production</em> condition will use
<code>src/text-dev.js</code> instead of <code>text.js</code>.
We can add multiple conditions to the conditional package map, which will match
from first to last with the path being left unchanged as the default fallthrough.</p>
<p>By editing the <code>production</code> boolean property in <code>jspm.browser.js</code>, we can now
control which branch of the component text SystemJS will load.
The important point to note about conditional loading is that conditions are fixed 
for the duration of the execution environment.
The environment is either <code>node</code> or the <code>browser</code> (although environments like Electron are both <code>node</code> and <code>browser</code>), either running in <code>production</code> or not, until we explicitly restart the execution.</p>
<p>By default when we bundle, we will only bundle the production branches.</p>
<p>Run <code>jspm bundle jspm-react-component - react</code> to see how the tree excludes the <code>text-dev.js</code>
branch:</p>
<pre><code>     Building the bundle tree for jspm-react-component - react...

       jspm-react-component/component.js
       jspm-react-component/text.js
       npm:systemjs-plugin-babel@0.0.2.json
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/classCallCheck.js
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/createClass.js
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/inherits.js
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/possibleConstructorReturn.js

ok   Built into build.js with source maps, unminified.
</code></pre><p>If we instead run <code>jspm bundle jspm-react-component - react --dev</code> then bundling will
explicitly include the development branch only.</p>
<p>To include both possible branch outcomes in the bundle, use <code>jspm bundle jspm-react-component - react --dev --production</code>:</p>
<pre><code>     Building the bundle tree for jspm-react-component - react...

       jspm-react-component/component.js
       jspm-react-component/text.js
       jspm-react-component/text-dev.js
       npm:systemjs-plugin-babel@0.0.2.json
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/classCallCheck.js
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/createClass.js
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/inherits.js
       npm:systemjs-plugin-babel@0.0.2/babel-helpers/possibleConstructorReturn.js

ok   Built into build.js with source maps, unminified.
</code></pre><p><em>In the same way that we have used <code>production</code> in this example, we can also use <code>node</code> and <code>browser</code>
  as conditional branches that conditionally load and build.</em></p>
<p>Conditional loading also applies to <code>jspm build</code>, but we must always build an exact
branch solution when using <code>jspm build</code>. That is, we must build for dev or production,
exclusively, browser or node exclusively.</p>
<p>For example, to build a Node-only single-file production version of React:</p>
<pre><code>  jspm build react --node --production --format cjs react-node-production-build.js
</code></pre><p>We can then test this with:</p>
<pre><code>  node -e &quot;console.log(require(&apos;./react-node-production-build.js&apos;))&quot;
</code></pre><p>to see that React has been correctly built and linked for running in Node in production.</p>
<p>By replacing <code>--node</code> with <code>--browser</code> in the above build we can also create a 
Browserify-style build of React for production, which will then only include all the 
necessary Browserify shims for the NodeJS core modules.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./overrides.html" class="navigation navigation-prev " aria-label="Previous page: Overrides"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./conditional-substitution.html" class="navigation navigation-next " aria-label="Next page: Conditional Substitution"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="gitbook/plugins/gitbook-plugin-ga/plugin.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/lunr.min.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-search/search.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-sharing/buttons.js"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-fontsettings/buttons.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"ga":{"token":"UA-40327700-1","configuration":"auto"},"highlight":{},"search":{"maxIndexSize":1000000},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
